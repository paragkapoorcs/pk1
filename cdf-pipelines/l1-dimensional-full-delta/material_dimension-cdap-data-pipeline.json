{
    "name": "material_dimension",
    "description": "material dimension",
    "artifact": {
        "name": "cdap-data-pipeline",
        "version": "6.4.0",
        "scope": "SYSTEM"
    },
    "config": {
        "resources": {
            "memoryMB": 2048,
            "virtualCores": 1
        },
        "driverResources": {
            "memoryMB": 2048,
            "virtualCores": 1
        },
        "connections": [
            {
                "from": "Merge Statement",
                "to": "Update Audit Table"
            }
        ],
        "comments": [],
        "postActions": [],
        "properties": {},
        "processTimingEnabled": true,
        "stageLoggingEnabled": false,
        "stages": [
            {
                "name": "Merge Statement",
                "plugin": {
                    "name": "BigQueryExecute",
                    "type": "action",
                    "label": "Merge Statement",
                    "artifact": {
                        "name": "google-cloud",
                        "version": "0.17.0",
                        "scope": "SYSTEM"
                    },
                    "properties": {
                        "project": "auto-detect",
                        "sql": "MERGE INTO `${ProjectID}.${TargetDatasetNames2}.material_dimension` tgt\nUSING \n(WITH tmp_scr AS (SELECT\n            (mm.material_number || '-' || mpd.plant) as material_key,\n            mm.material_number,\n            mpd.plant,\n            mm.material_group,\n            mm.industry_sector,\n            mm.material_type,\n            mm.created_on,\n            mm.created_by,\n            mm.last_change,\n            mm.changed_by,\n            mm.complete_material_status,\n            mm.client_level_deletion_flag,\n            mm.old_material_number,\n            mm.base_unit_of_measure,\n            mm.purchase_order_unit,\n            mm.document_number,\n            mm.document_type,\n            mm.document_version,\n            mm.page_format_2,\n            mm.document_change_number,\n            mm.page_number,\n            mm.number_of_sheets,\n            mm.production_memo,\n            mm.page_format_1,\n            mm.size_dimensions,\n            mm.basic_material,\n            mm.industry_standard_description,\n            mm.laboratory_design_office,\n            mm.purchasing_value_key,\n            mm.gross_weight,\n            mm.net_weight,\n            mm.weight_unit,\n            mm.volume,\n            mm.volume_unit_2,\n            mm.container_requirements,\n            mm.storage_conditions,\n            mm.temperature_conditions_indicator,\n            mm.low_level_code,\n            mm.transportation_group,\n            mm.hazardous_material_number,\n            mm.division,\n            mm.customer_number,\n            mm.european_article_number,\n            mm.goods_receipt_slips_quantity,\n            mm.procurement_rule,\n            mm.season_category,\n            mm.label_type,\n            mm.label_form,\n            mm.disposal_type,\n            mm.international_article_number,\n            mm.ean_category,\n            mm.length,\n            mm.width,\n            mm.height,\n            mm.unit_of_dimension,\n            mm.product_hierarchy,\n            mm.net_change_costing,\n            mm.cad_indicator,\n            mm.qm_procurement,\n            mm.allowed_packaging_weight,\n            mm.unit_of_weight,\n            mm.allowed_packaging_volume,\n            mm.volume_unit_1,\n            mm.excess_weight_tolerance,\n            mm.excess_volume_tolerance,\n            mm.variable_purchase_order_unit_active,\n            mm.revision_level_assigned,\n            mm.packaging_material_type,\n            mm.maximum_level,\n            mm.stacking_factor,\n            mm.material_group_packaging_materials,\n            mm.authorization_group,\n            mm.deletion_date,\n            mm.season_year,\n            mm.price_band_category,\n            mm.empties_bill_of_material,\n            mm.external_material_group,\n            mm.cross_plant_configurable_material,\n            mm.material_category,\n            mm.pricing_reference_material,\n            mm.cross_plant_material_status,\n            mm.cross_distribution_chain_status,\n            mm.cross_plant_valid_from,\n            mm.cross_distribution_valid_from,\n            mm.tax_classification,\n            mm.catalog_profile,\n            mm.minimum_remaining_shelf_life,\n            mm.total_shelf_life,\n            mm.storage_percentage,\n            mm.content_unit,\n            mm.net_contents,\n            mm.comparison_price_unit,\n            mm.labeling_material_grouping,\n            mm.gross_contents,\n            mm.quantity_conversion_method,\n            mm.environmentally_relevant,\n            mm.product_allocation,\n            mm.pricing_profile,\n            mm.discount_in_kind,\n            mm.manufacturer_part_number,\n            mm.manufacturer_number,\n            mm.inventory_material_number,\n            mm.manufacturer_part_profile,\n            mm.units_of_measure_usage,\n            mm.rollout_season,\n            mm.dangerous_goods_indicator_profile,\n            mm.highly_viscous,\n            mm.in_bulk_liquid,\n            mm.serialization_level,\n            mm.closed,\n            mm.approved_batch_record_required,\n            mm.assign_effectivity_values,\n            mm.material_completion_level,\n            mm.shelf_life_expiration_date,\n            mm.rounding_rule_sled,\n            mm.product_composition,\n            mm.general_category_group,\n            mm.logistical_variants,\n            mm.cw_material,\n            mm.valuation_unit_of_measure,\n            mm.cw_tolerance_group,\n            mm.checkbox,\n            mm.base_unit_of_measure_1,\n            mm.nato_stock_number,\n            mm.internal_charactieristic_number,\n            mm.internal_char_number_main,\n            mm.internal_char_number_second,\n            mm.colors_of_variants,\n            mm.main_size,\n            mm.second_size,\n            mm.free_characteristic_value,\n            mm.care_code,\n            mm.brand,\n            mm.fiber_code_component_1,\n            mm.percentage_share_1,\n            mm.fiber_code_component_2,\n            mm.percentage_share_2,\n            mm.fiber_code_component_3,\n            mm.percentage_share_3,\n            mm.fiber_code_component_4,\n            mm.percentage_share_4,\n            mm.material_group_hierarchy_level_1,\n            mm.material_group_hierarchy_level_2,\n            mm.material_group_hierarchy_level_3,\n            mm.material_group_hierarchy_level_4,\n            mm.fashion_grade,\n            md.language_key,\n            md.material_description,\n            mc.product_cost,\n            mc.currency_key,\n            mpd.maintenance_status,\n            mpd.plant_level_deletion_flag,\n            mpd.valuation_category,\n            mpd.batch_management_indicator,\n            mpd.plant_specific_material_status,\n            mpd.valid_from,\n            mpd.abc_indicator,\n            mpd.critical_part,\n            mpd.purchasing_group,\n            mpd.unit_of_issue,\n            mpd.mrp_profile,\n            mpd.mrp_type,\n            mpd.mrp_controller,\n            mpd.mrp_controller_buyer,\n            mpd.planned_deliv_time,\n            mpd.goods_receipt_processing_time,\n            mpd.period_indicator,\n            mpd.assembly_scrap,\n            mpd.lot_sizing_procedure,\n            mpd.procurement_type,\n            mpd.special_procurement_type,\n            mpd.dependent_requirements_indicator,\n            mpd.storage_costs_code,\n            mpd.selection_method,\n            mpd.discontinuation_indicator,\n            mpd.effective_out_date,\n            mpd.follow_up_material,\n            mpd.requirements_group,\n            mpd.mixed_mrp_indicator,\n            mpd.scheduling_margin_key,\n            mpd.automatic_fixing_planned_orders,\n            mpd.automatic_release,\n            mpd.backflush,\n            mpd.production_supervisor,\n            mpd.processing_time,\n            mpd.setup_time,\n            mpd.interoperation_time,\n            mpd.in_house_production,\n            mpd.maximum_storage_period,\n            mpd.time_unit,\n            mpd.withdrawal_production_bin,\n            mpd.rough_cut_planning,\n            mpd.overdelivery_tolerance_limit,\n            mpd.unlimited_overdelivery_allowed,\n            mpd.underdely_tolerance,\n            mpd.total_replenishment_lead_time,\n            mpd.replacement_part,\n            mpd.surcharge_factor_percent,\n            mpd.state_of_manufacture,\n            mpd.stock_type,\n            mpd.sample_percentage,\n            mpd.quarantine_period,\n            mpd.qm_control_key,\n            mpd.mean_inspection_duration,\n            mpd.inspection_plan_indicator,\n            mpd.documentation_required,\n            mpd.active_substance,\n            mpd.inspection_interval,\n            mpd.next_inspection,\n            mpd.loading_group,\n            mpd.batch_management_requirement,\n            mpd.quota_arrangement_usage,\n            mpd.service_level,\n            mpd.splitting_indicator,\n            mpd.plan_version,\n            mpd.object_type,\n            mpd.object_id,\n            mpd.availability_check,\n            mpd.fiscal_year_variant,\n            mpd.correction_factors,\n            mpd.shipping_setup_time,\n            mpd.shipping_processing_time,\n            mpd.delivery_cycle,\n            mpd.source_of_supply,\n            mpd.automatic_purchase_order,\n            mpd.source_list,\n            mpd.commodity_code,\n            mpd.country_of_origin,\n            mpd.region_of_origin,\n            mpd.commodity_code_unit,\n            mpd.intrastat_material_group,\n            mpd.profit_center,\n            mpd.planning_calendar,\n            mpd.repetitive_manufacturing,\n            mpd.planning_time_fence,\n            mpd.consumption_mode,\n            mpd.backward_consumption_period,\n            mpd.forward_consumption_period,\n            mpd.version_indicator,\n            mpd.alternative_bom,\n            mpd.bom_usage,\n            mpd.task_list_group,\n            mpd.group_counter,\n            mpd.special_procurement_costing,\n            mpd.production_unit,\n            mpd.production_storage_location,\n            mpd.mrp_group,\n            mpd.component_scrap,\n            mpd.certificate_type,\n            mpd.inspection_setup,\n            mpd.takt_time,\n            mpd.coverage_profile,\n            mpd.local_field_name,\n            mpd.physical_inventory_indicator,\n            mpd.variance_key,\n            mpd.serial_number_profile,\n            mpd.internal_object_number,\n            mpd.configurable_material,\n            mpd.repetitive_manufacturing_profile,\n            mpd.negative_stocks,\n            mpd.target_qm_system,\n            mpd.planning_cycle,\n            mpd.rounding_profile,\n            mpd.reference_material_for_consumption,\n            mpd.reference_plant_for_consumption,\n            mpd.date_of_material,\n            mpd.multiplier_for_reference_material,\n            mpd.reset_automatically,\n            mpd.customs_preference,\n            mpd.exemption_certificate,\n            mpd.exemption_certificate_number,\n            mpd.issue_date_certificate,\n            mpd.vendor_declaration_code,\n            mpd.vendor_declaration_date,\n            mpd.military_goods,\n            mpd.isr_service_level,\n            mpd.material_co_product,\n            mpd.planning_strategy_group,\n            mpd.material_internal_object_number,\n            mpd.storage_location_external_procurement,\n            mpd.bulk_material,\n            mpd.cc_indicator_fixed,\n            mpd.withdrawal_sequence_group,\n            mpd.qm_material_authorization,\n            mpd.adjustment_period,\n            mpd.task_list_type,\n            mpd.uom_group,\n            mpd.conversion_group,\n            mpd.air_bouyancy_factor,\n            mpd.production_scheduling_profile,\n            mpd.safety_time_indicator,\n            mpd.safety_time,\n            mpd.action_control,\n            mpd.batch_entry,\n            mpd.controlling_area,\n            CASE WHEN mm.dw_last_update_date > md.dw_last_update_date and mm.dw_last_update_date > mpd.dw_last_update_date and mm.dw_last_update_date > mc.dw_last_update_date\n                 THEN mm.dw_last_update_date\n                 WHEN mpd.dw_last_update_date > mm.dw_last_update_date and mpd.dw_last_update_date > md.dw_last_update_date and mpd.dw_last_update_date > mc.dw_last_update_date\n                 THEN mpd.dw_last_update_date\n                 WHEN md.dw_last_update_date > mm.dw_last_update_date and md.dw_last_update_date > mpd.dw_last_update_date and md.dw_last_update_date > mc.dw_last_update_date\n                 THEN md.dw_last_update_date\n                 ELSE mc.dw_last_update_date\n            END AS input_last_update_date,\n            mm.dw_active_indicator\n      FROM `${ProjectID}.${StagingDatasetName}.material_master` mm\n           INNER JOIN `${ProjectID}.${StagingDatasetName}.material_plant_data` mpd \n        ON mpd.dw_active_indicator = 'Y'\n       AND mpd.material_number = mm.material_number\n           INNER JOIN `${ProjectID}.${StagingDatasetName}.material_description` md\n        ON md.material_number = mm.material_number\n       AND md.dw_active_indicator = mm.dw_active_indicator\n       AND md.language_key IN ('E','EN')\n            INNER JOIN (\nselect plant,material_number,currency_key,product_cost,dw_last_update_date\nfrom \n(select plant,material_number,currency_key,standard_price/price_unit as product_cost,fiscal_year_period,dw_last_update_date\n  ,row_number() over(partition by plant,material_number,currency_key order by plant,material_number,currency_key,fiscal_year_period desc) as rowpick\n  from `${ProjectID}.${StagingDatasetName}.material_valuation`\nwhere dw_active_indicator = 'Y' and price_control_indicator = 'S' and price_type = 'P01') where rowpick = 1\nunion distinct \nselect plant,material_number,currency_key,product_cost,dw_last_update_date\nfrom \n(select plant,material_number,currency_key,standard_price/price_unit as product_cost,fiscal_year_period,dw_last_update_date\n  ,row_number() over(partition by plant,material_number,currency_key order by plant,material_number,currency_key,fiscal_year_period desc) as rowpick\n                          from `${ProjectID}.${StagingDatasetName}.material_valuation`\nwhere dw_active_indicator = 'Y' and price_control_indicator = 'V' and price_type = 'P02') where rowpick = 1) mc\n         on mm.material_number = mc.material_number\n        and mpd.plant = mc.plant\n           left JOIN `${ProjectID}.${StagingDatasetName}.layer1_audit_table` lat\n        ON 1 = 1\n       AND lat.table_name = 'material_dimension'\n     WHERE mm.dw_active_indicator = 'Y'\n       AND (mm.dw_last_update_date >= CASE WHEN lat.full_delta_indicator = 'F' THEN lat.full_load_datetime\n                                           WHEN lat.full_delta_indicator <> 'F' THEN lat.delta_load_datetime\n                                           ELSE CAST('1900-01-01T00:00:00' AS DATETIME)\n                                      END\n        OR md.dw_last_update_date >= CASE WHEN lat.full_delta_indicator = 'F' THEN lat.full_load_datetime\n                                          WHEN lat.full_delta_indicator <> 'F' THEN lat.delta_load_datetime\n                                          ELSE CAST('1900-01-01T00:00:00' AS DATETIME)\n                                     END\n        OR mpd.dw_last_update_date >= CASE WHEN lat.full_delta_indicator = 'F' THEN lat.full_load_datetime\n                                           WHEN lat.full_delta_indicator <> 'F' THEN lat.delta_load_datetime\n                                           ELSE CAST('1900-01-01T00:00:00' AS DATETIME)\n                                      END\n        OR mc.dw_last_update_date >= CASE WHEN lat.full_delta_indicator = 'F' THEN lat.full_load_datetime\n                                            WHEN lat.full_delta_indicator <> 'F' THEN lat.delta_load_datetime\n                                            ELSE CAST('1900-01-01T00:00:00' AS DATETIME)\n                                       END)),\ntmp_mat AS (SELECT ts.*,\n     TO_HEX(MD5((select string_agg(CAST(col as STRING), ', ' order by offset)\n    from unnest(split(trim(format('%t',(select as struct ts.* except(input_last_update_date))), '()'),', ')) col with offset \n    where not col IS NULL\n    ))) as finalmd5key      \n  from tmp_scr ts)\nSELECT t.material_key as material_join_key,t.*\n  from tmp_mat t\nUNION ALL \nSELECT NULL as material_join_key,t.*\n  from tmp_mat t\n       INNER JOIN `${ProjectID}.${TargetDatasetNames2}.material_dimension` md\n    ON t.material_key = md.material_key\n   AND md.finalmd5key <> t.finalmd5key\n WHERE md.dw_active_indicator = 'Y') scr\n  ON tgt.material_key = scr.material_join_key\nWHEN MATCHED AND tgt.finalmd5key <> scr.finalmd5key THEN \nUPDATE set tgt.dw_end_date = CURRENT_DATETIME()\n          ,tgt.dw_active_indicator = 'N'\nWHEN NOT MATCHED THEN \nINSERT (\nmaterial_uuid,\nmaterial_key,\nmaterial_number,\nplant,\nmaterial_group,\nindustry_sector,\nmaterial_type,\ncreated_on,\ncreated_by,\nlast_change,\nchanged_by,\ncomplete_material_status,\nmaintenance_status,\nclient_level_deletion_flag,\nold_material_number,\nbase_unit_of_measure,\npurchase_order_unit,\ndocument_number,\ndocument_type,\ndocument_version,\npage_format_2,\ndocument_change_number,\npage_number,\nnumber_of_sheets,\nproduction_memo,\npage_format_1,\nsize_dimensions,\nbasic_material,\nindustry_standard_description,\nlaboratory_design_office,\npurchasing_value_key,\ngross_weight,\nnet_weight,\nweight_unit,\nvolume,\nvolume_unit_2,\ncontainer_requirements,\nstorage_conditions,\ntemperature_conditions_indicator,\nlow_level_code,\ntransportation_group,\nhazardous_material_number,\ndivision,\ncustomer_number,\neuropean_article_number,\ngoods_receipt_slips_quantity,\nprocurement_rule,\nseason_category,\nlabel_type,\nlabel_form,\ndisposal_type,\ninternational_article_number,\nean_category,\nmaterial_length,\nmaterial_width,\nmaterial_height,\nunit_of_dimension,\nproduct_hierarchy,\nnet_change_costing,\ncad_indicator,\nqm_procurement,\nallowed_packaging_weight,\nunit_of_weight,\nallowed_packaging_volume,\nvolume_unit_1,\nexcess_weight_tolerance,\nexcess_volume_tolerance,\nvariable_purchase_order_unit_active,\nrevision_level_assigned,\npackaging_material_type,\nmaximum_level,\nstacking_factor,\nmaterial_group_packaging_materials,\nauthorization_group,\ndeletion_date,\nseason_year,\nprice_band_category,\nempties_bill_of_material,\nexternal_material_group,\ncross_plant_configurable_material,\nmaterial_category,\npricing_reference_material,\ncross_plant_material_status,\ncross_distribution_chain_status,\ncross_plant_valid_from,\ncross_distribution_valid_from,\ntax_classification,\ncatalog_profile,\nminimum_remaining_shelf_life,\ntotal_shelf_life,\nstorage_percentage,\ncontent_unit,\nnet_contents,\ncomparison_price_unit,\nlabeling_material_grouping,\ngross_contents,\nquantity_conversion_method,\nenvironmentally_relevant,\nproduct_allocation,\npricing_profile,\ndiscount_in_kind,\nmanufacturer_part_number,\nmanufacturer_number,\ninventory_material_number,\nmanufacturer_part_profile,\nunits_of_measure_usage,\nrollout_season,\ndangerous_goods_indicator_profile,\nhighly_viscous,\nin_bulk_liquid,\nserialization_level,\nclosed,\napproved_batch_record_required,\nassign_effectivity_values,\nmaterial_completion_level,\nshelf_life_expiration_date,\nrounding_rule_sled,\nproduct_composition,\ngeneral_category_group,\nlogistical_variants,\ncw_material,\nvaluation_unit_of_measure,\ncw_tolerance_group,\ncheckbox,\nbase_unit_of_measure_1,\nnato_stock_number,\ninternal_charactieristic_number,\ninternal_char_number_main,\ninternal_char_number_second,\ncolors_of_variants,\nmain_size,\nsecond_size,\nfree_characteristic_value,\ncare_code,\nbrand,\nfiber_code_component_1,\npercentage_share_1,\nfiber_code_component_2,\npercentage_share_2,\nfiber_code_component_3,\npercentage_share_3,\nfiber_code_component_4,\npercentage_share_4,\nmaterial_group_hierarchy_level_1,\nmaterial_group_hierarchy_level_2,\nmaterial_group_hierarchy_level_3,\nmaterial_group_hierarchy_level_4,\nfashion_grade,\nlanguage_key,\nmaterial_description,\nproduct_cost,\ncurrency_key,\nplant_level_deletion_flag,\nvaluation_category,\nbatch_management_indicator,\nplant_specific_material_status,\nvalid_from,\nabc_indicator,\ncritical_part,\npurchasing_group,\nunit_of_issue,\nmrp_profile,\nmrp_type,\nmrp_controller,\nmrp_controller_buyer,\nplanned_deliv_time,\ngoods_receipt_processing_time,\nperiod_indicator,\nassembly_scrap,\nlot_sizing_procedure,\nprocurement_type,\nspecial_procurement_type,\ndependent_requirements_indicator,\nstorage_costs_code,\nselection_method,\ndiscontinuation_indicator,\neffective_out_date,\nfollow_up_material,\nrequirements_group,\nmixed_mrp_indicator,\nscheduling_margin_key,\nautomatic_fixing_planned_orders,\nautomatic_release,\nbackflush,\nproduction_supervisor,\nprocessing_time,\nsetup_time,\ninteroperation_time,\nin_house_production,\nmaximum_storage_period,\ntime_unit,\nwithdrawal_production_bin,\nrough_cut_planning,\noverdelivery_tolerance_limit,\nunlimited_overdelivery_allowed,\nunderdely_tolerance,\ntotal_replenishment_lead_time,\nreplacement_part,\nsurcharge_factor_percent,\nstate_of_manufacture,\nstock_type,\nsample_percentage,\nquarantine_period,\nqm_control_key,\nmean_inspection_duration,\ninspection_plan_indicator,\ndocumentation_required,\nactive_substance,\ninspection_interval,\nnext_inspection,\nloading_group,\nbatch_management_requirement,\nquota_arrangement_usage,\nservice_level,\nsplitting_indicator,\nplan_version,\nobject_type,\nobject_id,\navailability_check,\nfiscal_year_variant,\ncorrection_factors,\nshipping_setup_time,\nshipping_processing_time,\ndelivery_cycle,\nsource_of_supply,\nautomatic_purchase_order,\nsource_list,\ncommodity_code,\ncountry_of_origin,\nregion_of_origin,\ncommodity_code_unit,\nintrastat_material_group,\nprofit_center,\nplanning_calendar,\nrepetitive_manufacturing,\nplanning_time_fence,\nconsumption_mode,\nbackward_consumption_period,\nforward_consumption_period,\nversion_indicator,\nalternative_bom,\nbom_usage,\ntask_list_group,\ngroup_counter,\nspecial_procurement_costing,\nproduction_unit,\nproduction_storage_location,\nmrp_group,\ncomponent_scrap,\ncertificate_type,\ninspection_setup,\ntakt_time,\ncoverage_profile,\nlocal_field_name,\nphysical_inventory_indicator,\nvariance_key,\nserial_number_profile,\ninternal_object_number,\nconfigurable_material,\nrepetitive_manufacturing_profile,\nnegative_stocks,\ntarget_qm_system,\nplanning_cycle,\nrounding_profile,\nreference_material_for_consumption,\nreference_plant_for_consumption,\ndate_of_material,\nmultiplier_for_reference_material,\nreset_automatically,\ncustoms_preference,\nexemption_certificate,\nexemption_certificate_number,\nissue_date_certificate,\nvendor_declaration_code,\nvendor_declaration_date,\nmilitary_goods,\nisr_service_level,\nmaterial_co_product,\nplanning_strategy_group,\nmaterial_internal_object_number,\nstorage_location_external_procurement,\nbulk_material,\ncc_indicator_fixed,\nwithdrawal_sequence_group,\nqm_material_authorization,\nadjustment_period,\ntask_list_type,\nuom_group,\nconversion_group,\nair_bouyancy_factor,\nproduction_scheduling_profile,\nsafety_time_indicator,\nsafety_time,\naction_control,\nbatch_entry,\ncontrolling_area,\ninput_last_update_date,\nfinalmd5key,\ndw_active_indicator,\ndw_start_date,\ndw_end_date,\ndw_last_update_date)\nVALUES (TO_HEX(MD5(scr.material_key)),\nscr.material_key,\nscr.material_number,\nscr.plant,\nscr.material_group,\nscr.industry_sector,\nscr.material_type,\nscr.created_on,\nscr.created_by,\nscr.last_change,\nscr.changed_by,\nscr.complete_material_status,\nscr.maintenance_status,\nscr.client_level_deletion_flag,\nscr.old_material_number,\nscr.base_unit_of_measure,\nscr.purchase_order_unit,\nscr.document_number,\nscr.document_type,\nscr.document_version,\nscr.page_format_2,\nscr.document_change_number,\nscr.page_number,\nscr.number_of_sheets,\nscr.production_memo,\nscr.page_format_1,\nscr.size_dimensions,\nscr.basic_material,\nscr.industry_standard_description,\nscr.laboratory_design_office,\nscr.purchasing_value_key,\nscr.gross_weight,\nscr.net_weight,\nscr.weight_unit,\nscr.volume,\nscr.volume_unit_2,\nscr.container_requirements,\nscr.storage_conditions,\nscr.temperature_conditions_indicator,\nscr.low_level_code,\nscr.transportation_group,\nscr.hazardous_material_number,\nscr.division,\nscr.customer_number,\nscr.european_article_number,\nscr.goods_receipt_slips_quantity,\nscr.procurement_rule,\nscr.season_category,\nscr.label_type,\nscr.label_form,\nscr.disposal_type,\nscr.international_article_number,\nscr.ean_category,\nscr.length,\nscr.width,\nscr.height,\nscr.unit_of_dimension,\nscr.product_hierarchy,\nscr.net_change_costing,\nscr.cad_indicator,\nscr.qm_procurement,\nscr.allowed_packaging_weight,\nscr.unit_of_weight,\nscr.allowed_packaging_volume,\nscr.volume_unit_1,\nscr.excess_weight_tolerance,\nscr.excess_volume_tolerance,\nscr.variable_purchase_order_unit_active,\nscr.revision_level_assigned,\nscr.packaging_material_type,\nscr.maximum_level,\nscr.stacking_factor,\nscr.material_group_packaging_materials,\nscr.authorization_group,\nscr.deletion_date,\nscr.season_year,\nscr.price_band_category,\nscr.empties_bill_of_material,\nscr.external_material_group,\nscr.cross_plant_configurable_material,\nscr.material_category,\nscr.pricing_reference_material,\nscr.cross_plant_material_status,\nscr.cross_distribution_chain_status,\nscr.cross_plant_valid_from,\nscr.cross_distribution_valid_from,\nscr.tax_classification,\nscr.catalog_profile,\nscr.minimum_remaining_shelf_life,\nscr.total_shelf_life,\nscr.storage_percentage,\nscr.content_unit,\nscr.net_contents,\nscr.comparison_price_unit,\nscr.labeling_material_grouping,\nscr.gross_contents,\nscr.quantity_conversion_method,\nscr.environmentally_relevant,\nscr.product_allocation,\nscr.pricing_profile,\nscr.discount_in_kind,\nscr.manufacturer_part_number,\nscr.manufacturer_number,\nscr.inventory_material_number,\nscr.manufacturer_part_profile,\nscr.units_of_measure_usage,\nscr.rollout_season,\nscr.dangerous_goods_indicator_profile,\nscr.highly_viscous,\nscr.in_bulk_liquid,\nscr.serialization_level,\nscr.closed,\nscr.approved_batch_record_required,\nscr.assign_effectivity_values,\nscr.material_completion_level,\nscr.shelf_life_expiration_date,\nscr.rounding_rule_sled,\nscr.product_composition,\nscr.general_category_group,\nscr.logistical_variants,\nscr.cw_material,\nscr.valuation_unit_of_measure,\nscr.cw_tolerance_group,\nscr.checkbox,\nscr.base_unit_of_measure_1,\nscr.nato_stock_number,\nscr.internal_charactieristic_number,\nscr.internal_char_number_main,\nscr.internal_char_number_second,\nscr.colors_of_variants,\nscr.main_size,\nscr.second_size,\nscr.free_characteristic_value,\nscr.care_code,\nscr.brand,\nscr.fiber_code_component_1,\nscr.percentage_share_1,\nscr.fiber_code_component_2,\nscr.percentage_share_2,\nscr.fiber_code_component_3,\nscr.percentage_share_3,\nscr.fiber_code_component_4,\nscr.percentage_share_4,\nscr.material_group_hierarchy_level_1,\nscr.material_group_hierarchy_level_2,\nscr.material_group_hierarchy_level_3,\nscr.material_group_hierarchy_level_4,\nscr.fashion_grade,\nscr.language_key,\nscr.material_description,\nscr.product_cost,\nscr.currency_key,\nscr.plant_level_deletion_flag,\nscr.valuation_category,\nscr.batch_management_indicator,\nscr.plant_specific_material_status,\nscr.valid_from,\nscr.abc_indicator,\nscr.critical_part,\nscr.purchasing_group,\nscr.unit_of_issue,\nscr.mrp_profile,\nscr.mrp_type,\nscr.mrp_controller,\nscr.mrp_controller_buyer,\nscr.planned_deliv_time,\nscr.goods_receipt_processing_time,\nscr.period_indicator,\nscr.assembly_scrap,\nscr.lot_sizing_procedure,\nscr.procurement_type,\nscr.special_procurement_type,\nscr.dependent_requirements_indicator,\nscr.storage_costs_code,\nscr.selection_method,\nscr.discontinuation_indicator,\nscr.effective_out_date,\nscr.follow_up_material,\nscr.requirements_group,\nscr.mixed_mrp_indicator,\nscr.scheduling_margin_key,\nscr.automatic_fixing_planned_orders,\nscr.automatic_release,\nscr.backflush,\nscr.production_supervisor,\nscr.processing_time,\nscr.setup_time,\nscr.interoperation_time,\nscr.in_house_production,\nscr.maximum_storage_period,\nscr.time_unit,\nscr.withdrawal_production_bin,\nscr.rough_cut_planning,\nscr.overdelivery_tolerance_limit,\nscr.unlimited_overdelivery_allowed,\nscr.underdely_tolerance,\nscr.total_replenishment_lead_time,\nscr.replacement_part,\nscr.surcharge_factor_percent,\nscr.state_of_manufacture,\nscr.stock_type,\nscr.sample_percentage,\nscr.quarantine_period,\nscr.qm_control_key,\nscr.mean_inspection_duration,\nscr.inspection_plan_indicator,\nscr.documentation_required,\nscr.active_substance,\nscr.inspection_interval,\nscr.next_inspection,\nscr.loading_group,\nscr.batch_management_requirement,\nscr.quota_arrangement_usage,\nscr.service_level,\nscr.splitting_indicator,\nscr.plan_version,\nscr.object_type,\nscr.object_id,\nscr.availability_check,\nscr.fiscal_year_variant,\nscr.correction_factors,\nscr.shipping_setup_time,\nscr.shipping_processing_time,\nscr.delivery_cycle,\nscr.source_of_supply,\nscr.automatic_purchase_order,\nscr.source_list,\nscr.commodity_code,\nscr.country_of_origin,\nscr.region_of_origin,\nscr.commodity_code_unit,\nscr.intrastat_material_group,\nscr.profit_center,\nscr.planning_calendar,\nscr.repetitive_manufacturing,\nscr.planning_time_fence,\nscr.consumption_mode,\nscr.backward_consumption_period,\nscr.forward_consumption_period,\nscr.version_indicator,\nscr.alternative_bom,\nscr.bom_usage,\nscr.task_list_group,\nscr.group_counter,\nscr.special_procurement_costing,\nscr.production_unit,\nscr.production_storage_location,\nscr.mrp_group,\nscr.component_scrap,\nscr.certificate_type,\nscr.inspection_setup,\nscr.takt_time,\nscr.coverage_profile,\nscr.local_field_name,\nscr.physical_inventory_indicator,\nscr.variance_key,\nscr.serial_number_profile,\nscr.internal_object_number,\nscr.configurable_material,\nscr.repetitive_manufacturing_profile,\nscr.negative_stocks,\nscr.target_qm_system,\nscr.planning_cycle,\nscr.rounding_profile,\nscr.reference_material_for_consumption,\nscr.reference_plant_for_consumption,\nscr.date_of_material,\nscr.multiplier_for_reference_material,\nscr.reset_automatically,\nscr.customs_preference,\nscr.exemption_certificate,\nscr.exemption_certificate_number,\nscr.issue_date_certificate,\nscr.vendor_declaration_code,\nscr.vendor_declaration_date,\nscr.military_goods,\nscr.isr_service_level,\nscr.material_co_product,\nscr.planning_strategy_group,\nscr.material_internal_object_number,\nscr.storage_location_external_procurement,\nscr.bulk_material,\nscr.cc_indicator_fixed,\nscr.withdrawal_sequence_group,\nscr.qm_material_authorization,\nscr.adjustment_period,\nscr.task_list_type,\nscr.uom_group,\nscr.conversion_group,\nscr.air_bouyancy_factor,\nscr.production_scheduling_profile,\nscr.safety_time_indicator,\nscr.safety_time,\nscr.action_control,\nscr.batch_entry,\nscr.controlling_area,\nscr.input_last_update_date,\nscr.finalmd5key,\nscr.dw_active_indicator,\nCURRENT_DATETIME(),\nDATETIME(9999, 12, 31, 23, 59, 59),\nCURRENT_DATETIME());",
                        "dialect": "standard",
                        "mode": "batch",
                        "dataset": "${TargetDatasetNames2}",
                        "table": "material_dimension",
                        "useCache": "false",
                        "location": "US",
                        "rowAsArguments": "false",
                        "serviceAccountType": "filePath",
                        "serviceFilePath": "auto-detect"
                    }
                },
                "outputSchema": [
                    {
                        "name": "etlSchemaBody",
                        "schema": ""
                    }
                ],
                "id": "Merge-Statement",
                "type": "action",
                "label": "Merge Statement",
                "icon": "fa-plug"
            },
            {
                "name": "Update Audit Table",
                "plugin": {
                    "name": "BigQueryExecute",
                    "type": "action",
                    "label": "Update Audit Table",
                    "artifact": {
                        "name": "google-cloud",
                        "version": "0.17.0",
                        "scope": "SYSTEM"
                    },
                    "properties": {
                        "project": "auto-detect",
                        "sql": "MERGE INTO \n`${ProjectID}.${StagingDatasetName}.layer1_audit_table` tgt\nUSING ( SELECT \n         'material_dimension' as table_name\n         ,CASE WHEN (select full_delta_indicator from `${ProjectID}.${StagingDatasetName}.layer1_audit_table` where table_name = 'material_dimension') IS NULL\n                    OR (select full_delta_indicator from `${ProjectID}.${StagingDatasetName}.layer1_audit_table` where table_name = 'material_dimension') = 'F'\n               THEN 'F'\n               ELSE 'D'\n          END AS full_delta_indicator\n        ,'0MATERIAL_ATTR,0MATERIAL_TEXT,0MAT_PLANT_ATTR' as extractors_names\n        ,CAST('1900-01-01T00:00:00' AS DATETIME) as full_load_datetime\n        ,(select max(input_last_update_date) as delta_load_datatime from `${ProjectID}.${TargetDatasetNames2}.material_dimension`) as delta_load_datetime\n        ,(select COUNT(*) AS inserted_record_count from `${ProjectID}.${TargetDatasetNames2}.material_dimension` a inner join `${ProjectID}.${StagingDatasetName}.layer1_audit_table` b\n          on 1 = 1 where b.table_name = 'material_dimension' and  a.dw_last_update_date > CASE WHEN b.full_delta_indicator = 'F' \n                                                                                               THEN b.full_load_datetime\n                                                                                               WHEN b.full_delta_indicator <> 'F' THEN b.delta_load_datetime\n                                                                                               ELSE CAST('1900-01-01T00:00:00' AS DATETIME)\n                                                                                          END\n          and a.dw_active_indicator = 'Y') AS inserted_record_count\n        ,CURRENT_DATETIME() as last_update_date\n) scr\non tgt.table_name = scr.table_name\nWHEN MATCHED THEN \nUPDATE set tgt.full_load_datetime ='1900-01-01T00:00:00'\n          ,tgt.delta_load_datetime = scr.delta_load_datetime\n          ,tgt.inserted_record_count = scr.inserted_record_count\n          ,tgt.last_update_date = scr.last_update_date\n          ,tgt.extractors_names = scr.extractors_names\nWHEN NOT MATCHED THEN\nINSERT (table_name,\n        full_delta_indicator,\n        extractors_names,\n        full_load_datetime,\n        delta_load_datetime,\n        inserted_record_count,\n        last_update_date)\nVALUES(scr.table_name,\n       scr.full_delta_indicator,\n       scr.extractors_names,\n       scr.full_load_datetime,\n       scr.delta_load_datetime,\n       scr.inserted_record_count,\n       scr.last_update_date);",
                        "dialect": "standard",
                        "mode": "batch",
                        "dataset": "${StagingDatasetName}",
                        "table": "layer1_audit_table",
                        "useCache": "false",
                        "location": "US",
                        "rowAsArguments": "false",
                        "serviceAccountType": "filePath",
                        "serviceFilePath": "auto-detect"
                    }
                },
                "outputSchema": [
                    {
                        "name": "etlSchemaBody",
                        "schema": ""
                    }
                ],
                "id": "Update-Audit-Table",
                "type": "action",
                "label": "Update Audit Table",
                "icon": "fa-plug"
            }
        ],
        "schedule": "0 * * * *",
        "engine": "spark",
        "numOfRecordsPreview": 100,
        "description": "material dimension",
        "maxConcurrentRuns": 1
    }
}